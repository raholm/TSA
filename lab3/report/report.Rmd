---
title: "732A62 Lab 3"
author: "Emil K Svensson & Rasmus Holm"
date: "`r Sys.Date()`"
output:
    pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Assignment 1

## 1)

```{r}
library(astsa)
library(TSA)
library(forecast)

plot(chicken)
```

It looks like a linear, potentially quadratic, trend.

## 2)

```{r}
lm_data <- data.frame(chicken=chicken, time=1:length(chicken))
lm_fit <- lm(chicken ~ time, lm_data)
z <- resid(lm_fit)
plot(z, type="l", ylab="resid", xlab="Time")
```

The residuals do not look stationary.

## 3)

```{r}
periodogram(fft(z))
```

## 4)

```{r}

```

## 5)

```{r}

```

## 6)

```{r}

fit_plot <- function(model, data) {
    nahead <- 36
    pred <- predict(model, n.ahead=nahead, se.fit=TRUE)
    upper_band <- pred$pred + 1.96 * pred$se
    lower_band <- pred$pred - 1.96 * pred$se

    n <- length(data)

    plot(c(data, pred$pred), type="l",
         xlim=c(n - nahead, n + nahead),
         ylim=c(min(lower_band), max(upper_band)), ylab="Value", xlab="Time")
    lines(n + 1:nahead, upper_band, lty=2, col="red")
    lines(n + 1:nahead, lower_band, lty=2, col="red")
}
```

```{r}
fit <- arima(chicken, order=c(2, 1, 0), seasonal=list(order=c(0, 0, 1), period=12))
fit_plot(fit, chicken)
```

## 7)

```{r}
fit <- arima(chicken, order=c(3, 0, 0), seasonal=list(order=c(0, 0, 1), period=12))
fit_plot(fit, chicken)
```

\newpage

# Assignment 2

## 1)

```{r}

ld_oil <-diff(log(oil))

z <-ld_oil[1:(52*9 + 33)]

old <- par(mfrow = c(1,2))
acf(z)
pacf(z)
par(old)

suggested_model <- Arima(z, order = c(3,0,0))

summary(suggested_model)

r <- resid(suggested_model)
```

## 2)

```{r}
plot(r)
old <- par(mfrow = c(1,2))
acf(r^2)
pacf(r^2)
par(old)
```
The time series of the residuals seem to have an increasing variance in the end of the residuals.

The ACF of the squared residuals trails of and in the PACF they cuts of after 2 lags. Indicating a GARCH(p,q)
 An p = 2, q = 0 maybe?
## 3)

```{r}


helper <- function(data){
old <- par(mfrow = c(3,1))
acf(data)
acf(data^2)
qqnorm(data)  
qqline(data)
par(old)
jarque.bera.test(data)
Box.test(data, type = "Ljung-Box")
}

```

## 4)

```{r}

```

## 5)

```{r}

```

## 6)

```{r}

```
