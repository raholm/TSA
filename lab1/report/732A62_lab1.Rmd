---
title: "732A62 Lab 1"
author: "Emil K Svensson & Rasmus Holm"
date: "`r Sys.Date()`"
output:
    pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Assignment 1

## a)

```{r}
set.seed(12345)
t1 <- c(0, 0, rnorm(100, 0, 1))
ts1 <- filter(t1, filter = c(0, -0.8),
              method = "recursive", sides = 1)

t2 <- 1:100
ts2 <- cos(2 * pi * t2 / 5)

vt1 <- filter(ts1, filter = c(rep(0.2, times = 5)),
              method = "convolution", sides = 1)

vt2 <- filter(ts2, filter = c(rep(0.2, times = 5)),
              method = "convolution", sides = 1)
```

```{r, echo=FALSE}
par(mfrow = c(2, 2))
plot(ts1,type = "l", main = "ts1")
plot(ts2, type = "l", main = "ts2", xlab = "Time" )
plot(vt1,type = "l", main = "Smoothed ts1", ylim = c(-4, 4))
plot(vt2, type = "l", main = "Smoothed ts2", ylim = c(-1, 1))
par(mfrow = c(1, 1))
```

Time series 1 (ts1) show no noticable change in its random pattern except the scale which is transformed in to a smaller scale. Time series 2 (ts2) is flatened by the soothing filter and all values are now basicly 0. This is because the average of ts2 lies around zero it is also resonable to expect that a moving average smoother would generate the same (or similar) result.

## b)

```{r}
leftside <- c(1, -4, 2, 0, 0, 1) # the x's
rightside <- c(1, 0, 3, 0, 1, 0, -4) # The w's

causal <- polyroot(leftside) #Not causal
invertible <- polyroot(rightside) #Non invertible

complex_dist <- function(x) {
    sqrt(Re(x)^2 + Im(x)^2)
}

print("The causal")
sapply(causal, complex_dist)

print("The invertible")
sapply(invertible, complex_dist)
```

Since both parts contains values below 1 they are inside the unit circle and therefor are not causal nor invertible.

## c)

```{r}
set.seed(54321)
model1c <- arima.sim(n = 100, list(ar = c(-3 / 4), ma = c(0, -1 / 9) ))
acf(model1c)

tacf <- ARMAacf(ar=c(-3 / 4), ma=c(0, -1/9), lag.max=20)
plot(tacf, type="n", main="Theoretical")
segments(1:length(tacf), rep(0, length(tacf)), 1:length(tacf), tacf)
abline(h=0)
```

The ACF in the first plot there seem to be high correlation between all the lags except lag 11 and lag 12. Lag 2 has a larger correlation with the initial observation than the other lags. There seems to be no tendecise of the correlation dying down as the lags increases. 

In the theoretical ACF it seems to indicate that the correlation should be dying down in a positive to negative correlations between the lags. This would indicate that the ARMA we fitted is apart from what is expected from the theoretical and therefor not apropriate for the data.

# Assignment 2

```{r}
rhine <- read.csv2("../data/Rhine.csv")
colnames(rhine)[4] <- "Conc"

lmobj <- lm(Conc ~ Time, data = rhine)
predobj <- predict(lmobj, se.fit = TRUE)
```

```{r, echo=FALSE}
plot(y = rhine$Conc, x = rhine$Time, type = "l")
abline(lm(Conc ~ Time, data = rhine))
lines(predobj$fit + 1.96 * predobj$se.fit ~ as.numeric(rhine$Time))
lines(predobj$fit - 1.96 * predobj$se.fit ~ as.numeric(rhine$Time))
lag.plot(rhine$Conc, lags = 12)
```

```{r}
res1 <- residuals(lmobj)
summary(lmobj)
```

```{r, echo=FALSE}
acf(res1)
plot(res1)
abline(h = 0, col = "blue", lwd =2)
```

```{r}
kersmo <- ksmooth(y = rhine$Conc, x = rhine$Time, bandwidth = 5)
kerres <- kersmo$y - rhine$Conc
```

```{r, echo=FALSE}
plot(x = rhine$Time, y = rhine$Conc, type = "l", lwd =2)
lines(kersmo, col = "blue", lwd = 2.25, lty =2)

plot(kerres, type = "p")
abline(h = 0, col = "blue", lwd = 2)
acf(kerres)
```

```{r}
rhine$Month.f <- as.factor(rhine$Month)
dumlm <- lm(Conc ~ Time + Month.f, rhine)
```

```{r, echo=FALSE}
plot(resid(dumlm))
abline(h = 0, col = "blue", lwd=2)
acf(resid(dumlm))
```

```{r}
library(MASS)
stepAIC(dumlm, direction = "backward", steps = 1000)
```

# Assignment 3

```{r}
library(astsa)

plot(oil, col = "blue", ylim = c(0, 400))
lines(gas, col = "red")

loil <- log(oil)
lgas <- log(gas)

dloil <- diff(loil)
dlgas <- diff(lgas)

xt <- dloil
yt <- dlgas
```

```{r, echo=FALSE}
plot(loil, col = "blue", ylim = c(2, 6))
lines(lgas, col = "red")
```

```{r, echo=FALSE}
plot(dloil,col = "blue", ylim = c(-0.3, 0.4), lwd = 2)
lines(dlgas, col = "red", lty = 2, lwd = 1.25)

acf(dloil)
acf(dlgas)
```

```{r, echo=FALSE}
bw <- 0.05
kernel <- "normal"
lags <- c(0, 1, 2, 3)

old <- par(mfrow = c(2,2))

for (lag in lags) {
    x <- xt[(lag + 1):length(xt)]
    y <- yt[1:(length(yt) - lag)]
    plot(x, y)
    lines(ksmooth(x, y, kernel, bw))
}

par(old)
```

```{r}
tss <- ts.intersect(yt=yt, xt=xt, lag1xt=lag(xt, 1), dummy=xt > 0)
model3e <- lm(yt ~ xt + lag1xt + dummy, data = tss)
resid3e <- resid(model3e)
```

```{r, echo=FALSE}
plot(resid3e, type = "l")
abline(h=0, col = "red", lwd = 2, lty =1)
acf(resid3e)
```
