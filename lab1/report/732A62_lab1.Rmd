---
title: "732A62 Lab 1"
author: "Emil K Svensson & Rasmus Holm"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Assignment 1 

## a) 

```{r}

set.seed(12345)
t   <- c(0,0,rnorm(100,0,1))
ts1 <- filter(t, filter = c(0,-0.8), 
              method = "recursive", sides = 1) 

t   <- 1:100 
ts2 <- cos( 2*pi*t / 5)



vt1 <- filter(ts1, filter = c(rep(0.2, times = 5)),
              method = "convolution", sides = 1)

vt2 <- filter(ts2, filter = c(rep(0.2, times = 5)),
              method = "convolution", sides = 1)

par(mfrow = c(2,2))
plot(ts1,type = "l", main = "ts1")
plot(ts2, type = "l", main = "ts2", xlab = "Time" )
plot(vt1,type = "l", main = "Smoothed ts1", ylim = c(-4,4))
plot(vt2, type = "l", main = "Smoothed ts2", ylim = c(-1,1))
par(mfrow = c(1,1))


```

Time series 1 (ts1) show no noticable change in its random pattern except the scale which is transformed in to a smaller scale. Time series 2 (ts2) is flatened by the soothing filter and all values are now basicly 0. This is because the average of ts2 lies around zero it is also resonable to expect that a moving average smoother would generate the same (or similar) result. 

## b) 

```{r}
leftside <- c(1,-4,2,0,0,1) # the x's 
rightside <- c(1,0,3,0,1,0,-4) # The w's



causal<- polyroot(leftside)^2 #Not causal
invertible<- polyroot(rightside) #Non invertible

print("The causal")
sapply(causal, 
       FUN = function(x){
  sqrt(Re(x)^2 + Im(x)^2)
})

print("The invertible")
sapply(invertible, 
       FUN = function(x){
  sqrt(Re(x)^2 + Im(x)^2)
})



```
Since both parts contains values below 1 they are inside the unit circle and therefor are not causal nor invertible.


## c) 

```{r}
set.seed(54321)
model1c<- arima.sim(n = 100, list(ar = c(-3/4), ma = c(0,-1/9) ))

acf(model1c)
ARMAacf(model1c)
```


# Assignment 2

```{r}
rhine <- read.csv2("../data/Rhine.csv")

rhine <- ts(rhine)

rhine

plot(y = rhine[,4], x = rhine[,3], type = "l")
# abline(lm(rhine[,4] ~ rhine[,3], data = rhine))
# lines(predobj$fit + 1.96*predobj$se.fit ~ as.numeric(rhine[,3]))
# lines(predobj$fit - 1.96*predobj$se.fit ~ as.numeric(rhine[,3]))




x <- rhine[,4]
old <- par(mfrow = c(3,4))
for (i in 1:12){ 
 plot(lag(x,i),x)
}
par(old)
```


```{r}
lmobj<-lm(rhine[,4] ~ rhine[,3], data = rhine)
res1 <- residuals(lmobj)
summary(lmobj)


acf(res1)
plot(res1)
abline(h = 0, col = "blue", lwd =2)
predobj<- predict(lmobj, se.fit = TRUE)
```


```{r}
plot(x = rhine[,3], y= rhine[,4], type = "l", lwd =2)
lines(ksmooth(y=rhine[,4], x = rhine[,3], bandwidth = 5), col = "blue", lwd = 2.25, lty =2)


kersmo <- ksmooth(y=rhine[,4], x = rhine[,3], bandwidth = 5)

kerres <- kersmo$y - rhine[,4]

plot(kerres, type = "p")
abline(h = 0, col = "blue", lwd = 2)

acf(kerres)


```


```{r}

month.f <- as.factor(rhine[,2])
dummyfit <- as.data.frame(model.matrix(rhine[,4]~ rhine[,3]+month.f))[,-1]
dumlm <- lm(rhine[,4]~.,dummyfit)

plot(resid(dumlm))
abline(h = 0, col = "blue", lwd=2)
acf(resid(dumlm))

```

```{r}
library(MASS)
stepAIC(dumlm,direction = "backward", steps = 1000)
```



# Assignment 3 

```{r}

library(astsa)

plot(oil,col = "blue", ylim = c(0,400))
lines(gas,col = "red")

loil <- log(oil)
lgas <- log(gas)

plot(loil,col = "blue", ylim = c(2,6))
lines(lgas,col = "red")
```


```{r}
dloil<-diff(loil)
dlgas<-diff(lgas)

plot(dloil,col = "blue", ylim = c(-0.3,0.4), lwd = 2)
lines(dlgas,col = "red", lty = 2, lwd = 1.25)

acf(dloil)
acf(dlgas)
```


```{r}
xt <- dloil
yt <- dlgas

old <- par(mfrow = c(2,2))
plot(x = xt, y = yt )
plot(x = xt, y = lag(yt,1) )
plot(x = xt, y = lag(yt,2) )
plot(x = xt, y = lag(yt,3) )
par(old)
```

```{r}

oilframe <- data.frame(yt,xt, dummy = ts(as.numeric(xt>0)),lagxt =lag(xt,-1))
oilframe <- ts.intersect(oilframe)
model3e<- lm(yt~dummy + xt + lagxt, data = oilframe)

resid3e <- resid(model3e)

plot(resid3e, type = "l")
abline(h=0, col = "red", lwd = 2, lty =1)
acf(resid3e)
```

